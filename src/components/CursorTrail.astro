---
// CursorTrail.astro - Subtle cursor trail effect
// Only shows on desktop (non-touch devices)
---

<div id="cursor-trail-container"></div>

<style is:global>
  #cursor-trail-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
  }

  .trail-particle {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    will-change: transform, opacity;
  }
</style>

<script is:inline>
  (function() {
    const container = document.getElementById('cursor-trail-container');
    if (!container) return;

    // Check if touch device - skip effect on mobile
    const isTouch = 'ontouchstart' in window ||
                    navigator.maxTouchPoints > 0 ||
                    window.matchMedia('(hover: none)').matches;

    if (isTouch) return;

    const particles = [];
    const maxParticles = 12;
    const color = '98, 125, 152'; // #627d98 in RGB

    let mouseX = 0;
    let mouseY = 0;
    let lastX = 0;
    let lastY = 0;

    function spawnParticle() {
      // Remove oldest particle if at max
      if (particles.length >= maxParticles) {
        const oldest = particles.shift();
        if (oldest && oldest.element) {
          oldest.element.remove();
        }
      }

      const element = document.createElement('div');
      element.className = 'trail-particle';

      // Random size between 3-5px
      const size = 3 + Math.random() * 2;

      element.style.width = size + 'px';
      element.style.height = size + 'px';
      element.style.backgroundColor = 'rgba(' + color + ', 0.5)';
      element.style.left = (mouseX - size / 2) + 'px';
      element.style.top = (mouseY - size / 2) + 'px';

      container.appendChild(element);

      particles.push({
        element: element,
        x: mouseX,
        y: mouseY,
        age: 0,
        maxAge: 300 + Math.random() * 200, // 300-500ms lifespan
        size: size
      });
    }

    function handleMouseMove(e) {
      mouseX = e.clientX;
      mouseY = e.clientY;

      // Only spawn particle if mouse has moved enough
      const dx = mouseX - lastX;
      const dy = mouseY - lastY;
      const distance = Math.sqrt(dx * dx + dy * dy);

      if (distance > 6) {
        spawnParticle();
        lastX = mouseX;
        lastY = mouseY;
      }
    }

    function animate() {
      for (let i = particles.length - 1; i >= 0; i--) {
        const particle = particles[i];
        particle.age += 16; // Approximate frame time

        const progress = particle.age / particle.maxAge;

        if (progress >= 1) {
          particle.element.remove();
          particles.splice(i, 1);
          continue;
        }

        // Ease out for smooth fade
        const easeOut = 1 - Math.pow(progress, 2);

        // Fade opacity
        const opacity = 0.5 * easeOut;

        // Shrink size
        const scale = easeOut;

        particle.element.style.opacity = opacity;
        particle.element.style.transform = 'scale(' + scale + ')';
      }

      requestAnimationFrame(animate);
    }

    // Start listening and animating
    document.addEventListener('mousemove', handleMouseMove);
    animate();
  })();
</script>
